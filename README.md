# 1、论文的目标和贡献
通过保留对称性提升攻击的隐蔽性
# 2、核心算法框架 
    1、对称元素检测
        目标: 识别点云中的对称平面和对称元素(部分级和补丁级)
        步骤: 
            1、使用八叉树和主轴变换来确定点云最优对称面
                1.1 构建八叉树表示(八叉树提供了点云的空间分布信息, 便于后续分析):
                    计算点云的最小边界框
                    递归分割: 若子区域点数 > 阈值, 继续递归分割; 若点数 < 阈值或达到最大深度，停止分割，生成叶节点
                1.2 主轴变换(PCA分析):确定点云的主要方向，推导候选对称平面的法向量
                    计算点云质心，计算协方差进行特征分解
                1.3 确定候选对称面
                    基于主轴变换，生成三个候选对称平面, 平面方程形式为: a(x - μ_x) + b(y - μ_y) + c(z - μ_z) = 0, 其中(a, b, c)是法线向量
                    以第三个方差最小的主轴为法线的平面为对称面

            2、通过最远采样和语义距离采样部分级元素: 提取语义上相关的对称点集
                2.1 使用最远点采样选取 k 个关键点
                2.2 通过预训练模型提取点云的语义特征
                2.3 根据语义距离进行聚类, 生成部分级元素 E_part
                2.4 根据语义阈值进行过滤
            3、在剩余区域基于欧几里得距离采样补丁级元素: : 覆盖未被部分级元素占据的区域，提取几何对称点集
                3.1 获取剩余点
                3.2 用欧几里得距离聚类，生成补丁级元素 E_patch
            4、验证对称性,去除不符合条件的元素: 确保采样元素满足对称性条件
                合并所有元素(部分级 + 补丁级): E_all = E_part + E_patch
                对每个元素 E, 计算其基于对称平面S的镜像点 E'
                通过八叉树和距离匹配来检查镜像点是否在点云中存在对应点
                验证对称性是否满足条件 (点数匹配 + 平均距离小于阈值)

        伪代码:
            Input: 干净的点云 P ( n x 3 )
            Output: 对称平面 S, 对称元素集合 ES
            使用八叉树和主轴变换识别对称平面
            采样部分级元素:
                采样 k 个关键点
                提取语义特征并聚类
                过滤元素
            采样补丁级元素
                获取剩余未覆盖点
            验证对称

    2、 对称攻击
        目标: 利用梯度方法(如IFGM)生成初步的对抗性扰动，能够时点云骗过分类器
        步骤:
            1、计算误分类损失的梯度: 获取点云扰动方向
                1.1 输入当前对抗点云 P'(t) 到分类器计算输出
                1.2 计算误分类损失 loss = -交叉熵损失(output, label)
                1.3 反向传播,得到梯度 ▽P'(t)
            2、根据梯度方向和幅度生成扰动: 确定扰动大小和方向
                 ▲P = ε·sign(▽P'(t))
                
            3、将扰动应用在原始的点云中
                P'(t+1) = P'(t) + ▲P
        伪代码:
            Input: 点云 P
            Output: 对抗性点云 adv_P
            计算梯度
            生成扰动
            ▲P = ε·sign(▽P'(t))
            P'(t+1) = P'(t) + ▲P

    3、对称性调整
        目标: 确保对称点对的扰动向量保持对称性, d_p = M(d_p_m), d_p_m = M(d_p), M(d_p)是d_p的镜像
        对称性感知的对抗性攻击: 在生成初始扰动后,调整对称点的扰动向量, 使其相对于对称平面保持对称
        3.1 初始扰动向量
            d_p = P' - P  // 原始点的扰动
            d_p_m = P_m' - P_m   // 镜像点的扰动
        3.2 方向调整: 使d_p和d_p_m互为镜像
            new_d_p = d_p + α(M(d_p_m) - d_p)
            new_d_p_m = d_p_m + α(M(d_p) = d_p_m)
        3.3 调整幅度: 同一对称点对的扰动大小    
            σ = min(||d_p||, ||d_p_m||)
            P' = P + σ·new_d_p
            P_m' = P_m + σ · new_d_p_m
        3.4 把调整后的扰动应用到对抗点云中
# 3、补充
    3.1 主轴变换与对称平面的关系:
        在3D几何中，主轴变换通常是通过分析点云的协方差矩阵找到其主要分布方向的过程，PCA是实现其变换的常用工具

    3.2 对称平面的识别:
        对称平面通常和点云的几何分布特征相关, 对于对称的物体, 对称平面要么与主要分布方向垂直, 要么沿最小方法分布方向, 
        PCA提供了数据驱动的方式来确定这些方向

    3.3 为什么要用PCA来分析点云的分布方向实现主轴变换识别对称平面:
        1、PCA 不需要先验假设对称平面的方向，完全基于点云数据的分布特性
        2、点云可能包含噪声或不规则形状，PCA 通过统计分析提取全局特征，能较好地处理这些情况
        3、点云的对称性（通常表现为某些方向上的分布对称。PCA 通过分析点云的协方差矩阵，直接揭示这些分布方向，为对称平面提供候选方向

    3.4 为什么论文假设把第三主轴作为对称平面法线
        1、第三主轴代表着最小方差方向, 在对称物体中对称平面垂直于点云分布变化最小的方向
            (因为对称性意味着沿法线方向的投影是对称的,方差较小, 而垂直于法线的方向方差比较大)
    3.5 协方差矩阵
        对角线元素标示着每个维度自身的方差, 衡量该维度坐标的分散程度,方差越大说明数据在该维度上分布的越分散
        非对角线元素表示着维度之间的相关性(正相关、负相关还是没有线性相关性)
        协方差矩阵不仅告诉每个维度有多分散，还告诉各维度之间是怎么协同变化的
        对称性代表着数据在某些方向上的分布有规律性，这会反映在协方差矩阵和特征值上:
            完全对称(如球):
                由于所有方向上的分布一致，协方差矩阵会接近一个对角矩阵，且对角线元素（方差）相等，非对角线元素（协方差）接近 0
                在完全对称的情况下，所有方向上的方差相等，PCA 无法区分“主方向”，因为数据在所有方向上的分布完全一致
                特征值: λ_1 = λ_2 = λ_3 = 方差, 三个方向的方差都相等
                特征向量: 任意一组正交基([1,0,0], [0,1,0], [0,0,1])，具体方向不唯一因为球形对称性没有优先方向

            轴对称(圆柱) 
                假设是一个沿 z 轴对称的圆柱，x 和 y 方向对称, 圆柱沿着z轴伸展
                协方差矩阵: 对角线中前两个值相等(x和y对称，方向相等),最后一个代表z轴方差的值较大 其他非对角线位置为0(与方向 z 没用相关性)
                特征值: λ_1 = 沿z轴的方差, λ_2 = λ_3 = x_y平面内的方差
                特征向量: v_1 = [0, 0, 1]
                在对称方向的方差相等, 非对称方向的方差不同

        在对称方向上的方差会小于其他方向的方差(对称方向上，点的分布受到更严格的几何约束)
        对称轴通常对应于主成分分析(PCA)中的主要特征方向：
            
            
    
    3.6 PCA分析
        计算质心(均值): μ = 1/n ΣP_i
        计算协方差矩阵: 
            点云去中心化: P_i' = P_i - μ
            构造协方差矩阵 C = 1/n Σ P_i'·P_i'.T   // C表示点云在x、y、z方向上的分布方差和协方差
        特征分解: 对协方差矩阵C进行特征分解,得到特征值λ_1, λ_2, λ_3 和 对应的特征向量 v_1, v_2, v_3 (按降序排列)
        让特征向量表示点云的三个主轴:
            第一主轴, v_1: 点云分布的最大方差方向
            第二主轴, v_2: 点云分布的次大方向, 且与第一主成分正交
            第三主轴, v_3: 最小方差方向, 通常与对称平面法线相关, 与前两个主成分正交
    3.7 部分级元素: 指点云中具有语义一致性和几何临近性的点集
        语义距离: 指点云中两个点在特征空间中的距离, 通常由一个预训练的模型提取的特征向量计算得出: d_s(P_i, P_j) = || f(P_i) - f(P_j)||^2, f(P_i)和f(P_j)是通过模型提取的特征向量
    
    3.8 补丁级元素: 是指点云中不属于部分级元素的剩余点中，通过集合临近性聚类形成的小规模点击，对应于点云中局部区域，不一定具有明确的语义特征
                    属于物理距离聚类，是对部分级元素的补充，覆盖点云中还没有被部分级占据的区域
    3.9 八叉树表示
        八叉树提供了点云的空间分布信息, 便于后续分析:
                初始化边界框: 计算点云最小边界框,即包含所有点的最小立方体，
                递归分割: 将边界框沿着x、y、z轴各二等分,分为八个相等的子立方体; 
                    if 点数 > 某个阈值(可以是用户定义的最小点数): 继续递归分割
                    else if (点数 < 阈值 || 达到最大深度) : 停止分割
                生成八叉树: 最后得到一个树状结构: 每个节点表示一个子区域,叶节点包含少量点或为空
    3.10 对称面
                        (对称平面通常通过云点的质心, 且其法可能与某个主轴对齐)
                        平面1: 法线为 v_1, 通过质心μ
                        平面2: 法线为 v_2, 通过质心μ
                        平面3: 法线为 v_3, 通过质心μ
                    对于每个候选平面, 利用八叉树的层次结构快速计算(通过空间分区快速找到最近邻点，避免全局搜索)点云在平面两侧的分布:
                        将点云分为两个部分: P_left (平面左侧)、P_right(平面右侧)
                        对每侧的点, 计算其基于平面S的镜像点 P_i'
                             在3D点云对称性检测方面，评估对称平面时常用的方法(本文没用)：    
                                 评估对称性
                                    对每个候选平面, 计算镜像点和原始点的匹配程度: 对 p_left中的每个点p_i找到p_right中最接近其镜像点p_i'的点计算平均距离:
                                        D = 1/n Σ min||p_i' - p_j ||^2, p_j是P_right中的点    
                                    同样对P_right重复这个过程，得到双向平均距离，是衡量对称性的一种标准度量，反映了两侧点云的镜像一致性
                                 选择最佳平面
                                    选择平均距离即对称性度量最小的平面最为最终平面 S, 如果所有平面的对称性度量都超过某个阈值，则点云没有明显的对称平面
                                       
